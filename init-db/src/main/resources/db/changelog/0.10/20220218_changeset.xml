<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
	  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">
    <changeSet id="V0.10-20220218-001" author="shawn" labels="order">
        <comment>计费系统-增加支付订单表</comment>
        <sql>
            CREATE TABLE `${table.prefix}economic_order_payment` (
            `id` bigint(20) unsigned NOT NULL COMMENT '主键',
            `space_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '空间站ID',
            `order_no` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '订单号',
            `payment_transaction_no` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '交易号',
            `currency` varchar(3) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'ISO货币代码(大写字母)',
            `amount` int unsigned NOT NULL DEFAULT '0' COMMENT '金额(对应币种的最小货币单位,人民币为分)',
            `pay_channel` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '支付渠道属性值',
            `pay_channel_transaction_id` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '支付渠道交易标识',
            `payment_date` timestamp NULL DEFAULT NULL COMMENT '付款时间',
            `payment_success` tinyint unsigned DEFAULT '0' COMMENT '是否付款成功(0:否,1:是)',
            `description` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '描述',
            `is_deleted` tinyint unsigned NOT NULL DEFAULT '0' COMMENT '删除标记(0:否,1:是)',
            `created_by` bigint DEFAULT NULL COMMENT '创建者',
            `updated_by` bigint DEFAULT NULL COMMENT '最后修改者',
            `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
            `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
            PRIMARY KEY (`id`) USING BTREE,
            UNIQUE KEY `uk_transaction_no` (`payment_transaction_no`) USING BTREE COMMENT '交易号唯一',
            KEY `k_order_no` (`order_no`) USING BTREE COMMENT '订单号索引'
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='经济模块-订单付款记录表';
        </sql>
    </changeSet>
    <changeSet id="V0.10-20220218-002" author="shawn" labels="order">
        <comment>计费系统-订单表增加订单号索引</comment>
        <sql>
            alter table `${table.prefix}economic_order` ADD UNIQUE INDEX `uk_order_no`(`order_no`) USING BTREE;
        </sql>
    </changeSet>
    <changeSet id="V0.10-20220218-003" author="shawn" labels="order">
        <comment>计费系统-订单表增加空间id索引</comment>
        <sql>
            alter table `${table.prefix}economic_order` ADD INDEX `k_space_id`(`space_id`) USING BTREE;        </sql>
    </changeSet>
</databaseChangeLog>
