<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
	  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="V0.2-20200312-033" author="ShawnDeng" labels="user">
        <comment>创建用户表</comment>
        <sql>
            CREATE TABLE `${table.prefix}user` (
            `id` bigint(20) NOT NULL COMMENT '主键',
            `uuid` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '用户ID',
            `nick_name` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '昵称',
            `mobile_phone` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '手机号码',
            `email` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '邮箱',
            `password` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '密码',
            `avatar` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '头像',
            `gender` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT '1' COMMENT '性别',
            `remark` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '备注',
            `ding_open_id` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '钉钉开放应用内的唯一标识',
            `ding_union_id` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '钉钉开发者企业内的唯一标识',
            `last_login_time` timestamp NULL DEFAULT NULL COMMENT '最后登录时间',
            `is_deleted` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '删除标记(1:是,0:否)',
            `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
            `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
            PRIMARY KEY (`id`) USING BTREE
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';
        </sql>
        <rollback>
            <dropTable tableName="${table.prefix}user"/>
        </rollback>
    </changeSet>

    <changeSet id="V0.2-20200312-034" author="ShawnDeng" labels="user">
        <comment>创建用户第三方平台关联表</comment>
        <sql>
            CREATE TABLE `${table.prefix}user_link` (
            `id` bigint(20) NOT NULL COMMENT '主键',
            `user_id` bigint(20) DEFAULT NULL COMMENT '用户ID(关联#vika_user#id)',
            `open_id` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '开放应用内的唯一标识',
            `union_id` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '开发者企业内的唯一标识',
            `nick_name` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '第三方昵称',
            `type` tinyint(2) unsigned DEFAULT '1' COMMENT '第三方类型(0:钉钉,1:微信)',
            `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
            `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
            PRIMARY KEY (`id`) USING BTREE,
            KEY `fk_user_id` (`user_id`) USING BTREE
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户第三方平台关联表';
        </sql>
        <rollback>
            <dropTable tableName="${table.prefix}user_link"/>
        </rollback>
    </changeSet>

    <changeSet id="V0.2-20200312-035" author="ShawnDeng" labels="user">
        <comment>创建用户微信授权管理表</comment>
        <sql>
            CREATE TABLE `${table.prefix}wechat_auth_permission` (
            `id` bigint(20) unsigned NOT NULL COMMENT '主键',
            `auth_id` bigint(20) NOT NULL COMMENT '授权方ID(关联#vika_wechat_authorization#id)',
            `permission_id` bigint(20) NOT NULL COMMENT '权限集ID',
            `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
            `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
            PRIMARY KEY (`id`) USING BTREE
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户微信授权管理表';
        </sql>
        <rollback>
            <dropTable tableName="${table.prefix}wechat_auth_permission"/>
        </rollback>
    </changeSet>

    <changeSet id="V0.2-20200312-036" author="ShawnDeng" labels="user">
        <comment>创建用户表</comment>
        <sql>
            CREATE TABLE `${table.prefix}wechat_authorization` (
            `id` bigint(20) unsigned NOT NULL COMMENT '主键',
            `authorizer_appid` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '授权方 appid',
            `authorizer_access_token` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '接口调用令牌',
            `access_token_expire` bigint(20) unsigned DEFAULT '0' COMMENT '令牌有效期，单位：秒',
            `authorizer_refresh_token` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '刷新令牌',
            `nick_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '昵称',
            `avatar` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '头像',
            `service_type` tinyint(2) unsigned DEFAULT NULL COMMENT '公众号类型 (0:订阅号,1:由历史老帐号升级后的订阅号,2:服务号)',
            `verify_type` tinyint(2) unsigned DEFAULT NULL COMMENT '公众号/小程序（只有-1/0）认证类型 (-1:未认证,0:微信,1:新浪微博,2:腾讯微博,3:已资质认证通过但还未通过名称认证,4:已资质认证通过、还未通过名称认证，但通过了新浪微博认证,5:已资质认证通过、还未通过名称认证，但通过了腾讯微博认证)',
            `user_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '原始 ID',
            `alias` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '公众号所设置的微信号',
            `principal_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '主体名称',
            `business_info` json DEFAULT NULL COMMENT '功能的开通状况（0代表未开通，1代表已开通）',
            `qrcode_url` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '二维码图片的 URL',
            `signature` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '小程序帐号介绍',
            `miniprograminfo` json DEFAULT NULL COMMENT '小程序配置',
            `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
            `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
            PRIMARY KEY (`id`) USING BTREE
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户微信授权方信息表';
        </sql>
        <rollback>
            <dropTable tableName="${table.prefix}wechat_authorization"/>
        </rollback>
    </changeSet>

    <changeSet id="V0.2-20200312-037" author="ShawnDeng" labels="user">
        <comment>创建用户微信信息表</comment>
        <sql>
            CREATE TABLE `${table.prefix}wechat_member` (
            `id` bigint(20) unsigned NOT NULL COMMENT '主键',
            `open_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '微信用户的唯一标识',
            `union_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '用户在微信开放平台的唯一标识符',
            `session_key` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '会话密钥',
            `mobile` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '手机号',
            `full_mobile` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '手机号（国外手机号会有区号）',
            `code` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '区号',
            `nick_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '昵称',
            `avatar` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '头像',
            `gender` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '性别',
            `language` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '语言',
            `city` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '城市',
            `province` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '省份',
            `country` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '国家',
            `is_deleted` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '删除标记(0:否,1:是)',
            `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
            `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
            PRIMARY KEY (`id`) USING BTREE
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户微信信息表';
        </sql>
        <rollback>
            <dropTable tableName="${table.prefix}wechat_member"/>
        </rollback>
    </changeSet>

</databaseChangeLog>
