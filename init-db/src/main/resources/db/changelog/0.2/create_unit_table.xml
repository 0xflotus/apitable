<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
	  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="V0.2-20200312-026" author="ShawnDeng" labels="unit">
        <comment>创建组织架构组织单元表</comment>
        <sql>
            CREATE TABLE `${table.prefix}unit` (
            `id` bigint(20) NOT NULL COMMENT '主键',
            `space_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '空间ID(关联#vika_space#space_id)',
            `unit_type` tinyint(2) unsigned NOT NULL COMMENT '类型(1:部门,2:标签,3:成员)',
            `unit_ref_id` bigint(20) NOT NULL COMMENT '组织单元关联ID',
            `is_deleted` tinyint(1) unsigned DEFAULT '0' COMMENT '删除标记(0:否,1:是)',
            `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
            PRIMARY KEY (`id`) USING BTREE,
            UNIQUE KEY `uk_unit_ref_id` (`unit_ref_id`) USING BTREE COMMENT '组织单元关联ID唯一'
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='组织架构-组织单元表';
        </sql>
        <rollback>
            <dropTable tableName="${table.prefix}unit"/>
        </rollback>
    </changeSet>

    <changeSet id="V0.2-20200312-027" author="ShawnDeng" labels="unit">
        <comment>创建组织架构成员表</comment>
        <sql>
            CREATE TABLE `${table.prefix}unit_member` (
            `id` bigint(20) NOT NULL COMMENT '主键',
            `user_id` bigint(20) DEFAULT NULL COMMENT '用户ID(关联#vika_user#id)',
            `space_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '空间ID(关联#vika_space#space_id)',
            `member_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '成员姓名',
            `job_number` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '工号',
            `position` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '职位',
            `mobile` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '手机号码',
            `email` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '电子邮箱',
            `ding_user_id` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '钉钉员工ID',
            `status` tinyint(2) unsigned DEFAULT '0' COMMENT '用户的空间状态(0:非活跃,1:活跃,2:预删除,3:未激活)',
            `is_point` tinyint(1) unsigned DEFAULT '0' COMMENT '是否有小红点(0:否,1:是)',
            `is_active` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '是否激活(0:否,1:是)',
            `is_admin` tinyint(1) unsigned DEFAULT '0' COMMENT '是否管理员(0:否,1:是)',
            `is_deleted` tinyint(1) unsigned DEFAULT '0' COMMENT '删除标记(0:否,1:是)',
            `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
            `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
            PRIMARY KEY (`id`) USING BTREE
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='组织架构-成员表';
        </sql>
        <rollback>
            <dropTable tableName="${table.prefix}unit_member"/>
        </rollback>
    </changeSet>

    <changeSet id="V0.2-20200312-028" author="ShawnDeng" labels="unit">
        <comment>创建组织架构标签表</comment>
        <sql>
            CREATE TABLE `${table.prefix}unit_tag` (
            `id` bigint(20) NOT NULL COMMENT '主键',
            `group_id` bigint(20) DEFAULT NULL COMMENT '标签组ID(关联#vika_org_tag_group#id)',
            `space_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '空间ID(关联#vika_space#space_id)',
            `tag_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '标签名称',
            `sequence` int(11) unsigned DEFAULT '1' COMMENT '空间内排序(默认从1开始)',
            `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
            `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
            PRIMARY KEY (`id`) USING BTREE
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='组织架构-标签表';
        </sql>
        <rollback>
            <dropTable tableName="${table.prefix}unit_tag"/>
        </rollback>
    </changeSet>

    <changeSet id="V0.2-20200312-029" author="ShawnDeng" labels="unit">
        <comment>创建组织架构标签组表</comment>
        <sql>
            CREATE TABLE `${table.prefix}unit_tag_group` (
            `id` bigint(20) NOT NULL COMMENT '主键',
            `space_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '空间ID(关联#vika_space#space_id)',
            `group_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '标签组名称',
            `sequence` int(11) unsigned DEFAULT '1' COMMENT '空间内排序(默认从1开始)',
            `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
            `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
            PRIMARY KEY (`id`) USING BTREE
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='组织架构-标签组表';
        </sql>
        <rollback>
            <dropTable tableName="${table.prefix}unit_tag_group"/>
        </rollback>
    </changeSet>

    <changeSet id="V0.2-20200312-030" author="ShawnDeng" labels="unit">
        <comment>创建组织架构标签成员关联表</comment>
        <sql>
            CREATE TABLE `${table.prefix}unit_tag_member_rel` (
            `id` bigint(20) NOT NULL COMMENT '主键',
            `tag_id` bigint(20) NOT NULL COMMENT '标签ID(关联#vika_org_tag#id)',
            `member_id` bigint(20) NOT NULL COMMENT '会员ID(关联#vika_org_member#id)',
            `creator` bigint(20) DEFAULT NULL COMMENT '创建者(关联#vika_user#id)',
            `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
            `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
            PRIMARY KEY (`id`) USING BTREE,
            KEY `tag_id` (`tag_id`) USING BTREE,
            KEY `member_id` (`member_id`) USING BTREE
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='组织架构-标签成员关联表';
        </sql>
        <rollback>
            <dropTable tableName="${table.prefix}unit_tag_member_rel"/>
        </rollback>
    </changeSet>

    <changeSet id="V0.2-20200312-031" author="ShawnDeng" labels="unit">
        <comment>创建组织架构部门表</comment>
        <sql>
            CREATE TABLE `${table.prefix}unit_team` (
            `id` bigint(20) NOT NULL COMMENT '主键',
            `space_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '空间ID(关联#vika_space#space_id)',
            `parent_id` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '父级ID,如果是根部门,则为0',
            `team_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '部门名称',
            `team_level` int(5) unsigned DEFAULT '1' COMMENT '层级，默认1开始',
            `sequence` int(11) unsigned DEFAULT '1' COMMENT '排序(同级默认从1开始)',
            `is_deleted` tinyint(1) unsigned DEFAULT '0' COMMENT '删除标记(0:否,1:是)',
            `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
            `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
            PRIMARY KEY (`id`) USING BTREE
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='组织架构-部门表';
        </sql>
        <rollback>
            <dropTable tableName="${table.prefix}unit_team"/>
        </rollback>
    </changeSet>

    <changeSet id="V0.2-20200312-032" author="ShawnDeng" labels="unit">
        <comment>创建组织架构部门成员关联表</comment>
        <sql>
            CREATE TABLE `${table.prefix}unit_team_member_rel` (
            `id` bigint(20) NOT NULL COMMENT '主键',
            `team_id` bigint(20) NOT NULL COMMENT '部门ID',
            `member_id` bigint(20) NOT NULL COMMENT '成员ID',
            `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
            PRIMARY KEY (`id`) USING BTREE,
            KEY `team_id_key` (`team_id`) USING BTREE,
            KEY `member_id_key` (`member_id`) USING BTREE
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='组织架构-部门成员关联表';
        </sql>
        <rollback>
            <dropTable tableName="${table.prefix}unit_team_member_rel"/>
        </rollback>
    </changeSet>
</databaseChangeLog>
